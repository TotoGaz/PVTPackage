#include "refactor/passiveDataStructures/MultiphaseSystemProperties.hpp"

// This include is necessary for nlohmann::json to find the proper serializers
#include "refactor/deserializers/MultiphaseSystemProperties.hpp"

#include "MultiphaseSystem/PhaseModel/CubicEOS/CubicEoSPhaseModel.hpp"
#include "MultiphaseSystem/PhaseModel/BlackOil/BlackOil_GasModel.hpp"
#include "MultiphaseSystem/PhaseModel/BlackOil/BlackOil_OilModel.hpp"
#include "MultiphaseSystem/PhaseModel/BlackOil/BlackOil_WaterModel.hpp"
#include "MultiphaseSystem/PhaseModel/BlackOil/DeadOil_PhaseModel.hpp"

#include "MultiphaseSystem/PhaseSplitModel/NegativeTwoPhaseFlash.hpp"
#include "MultiphaseSystem/PhaseSplitModel/BlackOilFlash.hpp"
#include "MultiphaseSystem/PhaseSplitModel/DeadOilFlash.hpp"

#include "MultiphaseSystem/MultiphaseSystemProperties.hpp"

#include <gtest/gtest.h>
#include <nlohmann/json.hpp>

#include <algorithm>

using json = nlohmann::json;

namespace PVTPackage
{
namespace refactor
{

PHASE_STATE convert( const pds::PHASE_STATE & input )
{
  const std::map< pds::PHASE_STATE, PHASE_STATE > m{
    { pds::PHASE_STATE::UNKNOWN,       PVTPackage::PHASE_STATE::UNKNOWN },
    { pds::PHASE_STATE::GAS,           PVTPackage::PHASE_STATE::GAS },
    { pds::PHASE_STATE::OIL,           PVTPackage::PHASE_STATE::OIL },
    { pds::PHASE_STATE::WATER,         PVTPackage::PHASE_STATE::WATER },
    { pds::PHASE_STATE::OIL_GAS,       PVTPackage::PHASE_STATE::OIL_GAS },
    { pds::PHASE_STATE::GAS_WATER,     PVTPackage::PHASE_STATE::GAS_WATER },
    { pds::PHASE_STATE::OIL_WATER,     PVTPackage::PHASE_STATE::OIL_WATER },
    { pds::PHASE_STATE::OIL_GAS_WATER, PVTPackage::PHASE_STATE::OIL_GAS_WATER }
  };

  return m.at( input );
}

PVTPackage::PHASE_TYPE convert( const pds::PHASE_TYPE & input )
{
  const std::map< pds::PHASE_TYPE, PHASE_TYPE > m{
    { pds::PHASE_TYPE::LIQUID_WATER_RICH, PVTPackage::PHASE_TYPE::LIQUID_WATER_RICH },
    { pds::PHASE_TYPE::OIL,               PVTPackage::PHASE_TYPE::OIL },
    { pds::PHASE_TYPE::GAS,               PVTPackage::PHASE_TYPE::GAS },
    { pds::PHASE_TYPE::UNKNOWN,           PVTPackage::PHASE_TYPE::UNKNOWN }
  };

  return m.at( input );
}

PVTPackage::EOS_TYPE convert( const pds::EOS_TYPE & input )
{
  const std::map< pds::EOS_TYPE, EOS_TYPE > m{
    { pds::EOS_TYPE::REDLICH_KWONG_SOAVE, PVTPackage::EOS_TYPE::REDLICH_KWONG_SOAVE },
    { pds::EOS_TYPE::PENG_ROBINSON,       PVTPackage::EOS_TYPE::PENG_ROBINSON },
    { pds::EOS_TYPE::UNKNOWN,             PVTPackage::EOS_TYPE::UNKNOWN }
  };

  return m.at( input );
}

std::vector< PVTPackage::PHASE_TYPE > convert( const std::vector< pds::PHASE_TYPE > & input )
{
  // FIXME I cannot give raw function to std::transform
  auto f = []( const pds::PHASE_TYPE & i )
  {
    return convert( i );
  };

  std::vector< PVTPackage::PHASE_TYPE > output( input.size() );
  std::transform( input.cbegin(), input.cend(), output.begin(), f );

  return output;
}

PVTPackage::ComponentProperties convert( const pds::ComponentProperties & input )
{
  return PVTPackage::ComponentProperties{ input.NComponents, input.Label, input.Mw, input.Tc, input.Pc, input.Omega };
}

PVTPackage::PVTGdata convert( const pds::PVTGdata & input )
{
  PVTPackage::PVTGdata output;

  output.Rv = input.Rv;
  output.DewPressure = input.DewPressure;

  output.NSaturatedPoints = input.NSaturatedPoints;
  output.SaturatedBg = input.SaturatedBg;
  output.SaturatedViscosity = input.SaturatedViscosity;

  output.UndersaturatedRv = input.UndersaturatedRv;
  output.UndersaturatedBg = input.UndersaturatedBg;
  output.UndersaturatedViscosity = input.UndersaturatedViscosity;

  output.setMaxRelativeRv( input.MaxRelativeRv );
  output.setMinRelativeRv( input.MinRelativeRv );

  return output;
}

PVTPackage::PVTWdata convert( const pds::PVTWdata & input )
{
  PVTPackage::PVTWdata output;

  output.ReferencePressure = input.ReferencePressure;
  output.Bw = input.Bw;
  output.Compressibility = input.Compressibility;
  output.Viscosity = input.Viscosity;

  return output;
}

PVTPackage::PVTOdata convert( const pds::PVTOdata & input )
{
  PVTPackage::PVTOdata output;

  output.Rs = input.Rs;
  output.BubblePressure = input.BubblePressure;

  output.NSaturatedPoints = input.NSaturatedPoints;
  output.SaturatedBo = input.SaturatedBo;
  output.SaturatedViscosity = input.SaturatedViscosity;

  output.UndersaturatedPressure = input.UndersaturatedPressure;
  output.UndersaturatedBo = input.UndersaturatedBo;
  output.UndersaturatedViscosity = input.UndersaturatedViscosity;

  output.setMaxRelativePressure( input.MaxRelativePressure );
  output.setMinRelativePressure( input.MinRelativePressure );

  return output;
}

PVTPackage::PVDdata convert( const pds::PVDdata & input )
{
  PVTPackage::PVDdata output;

  output.Pressure = input.Pressure;
  output.NPoints = input.NPoints;
  output.B = input.B;
  output.Viscosity = input.Viscosity;

  return output;
}

std::shared_ptr< PVTPackage::PhaseModel > convert( const std::shared_ptr< pds::PhaseModel > input )
{
  using namespace PVTPackage;

  if( auto pm = std::dynamic_pointer_cast< const pds::CubicEoSPhaseModel >( input ) )
  {
    auto output = std::make_shared< PVTPackage::CubicEoSPhaseModel >(
      convert( pm->m_ComponentsProperties ),
      convert( pm->m_EOSType ),
      convert( pm->m_PhaseType )
    );
    return output;
  }

  if( auto pm = std::dynamic_pointer_cast< const pds::BlackOilGasModel >( input ) )
  {
    auto output = std::make_shared< PVTPackage::BlackOil_GasModel >(
      convert( pm->m_PVTG ), pm->min_Pressure, pm->max_Pressure, pm->m_SurfaceMassDensity, pm->m_SurfaceMoleDensity,
      pm->m_SurfaceMolecularWeight
    );

    return output;
  }

  if( auto pm = std::dynamic_pointer_cast< const pds::BlackOilOilModel >( input ) )
  {
    auto output = std::make_shared< PVTPackage::BlackOil_OilModel >(
      convert( pm->m_PVTO ), pm->min_Pressure, pm->max_Pressure, pm->m_SurfaceMassDensity, pm->m_SurfaceMoleDensity,
      pm->m_SurfaceMolecularWeight
    );

    return output;
  }

  if( auto pm = std::dynamic_pointer_cast< const pds::BlackOilWaterModel >( input ) )
  {
    auto output = std::make_shared< PVTPackage::BlackOil_WaterModel >(
      convert( pm->m_PVTW ), pm->m_SurfaceMassDensity, pm->m_SurfaceMoleDensity, pm->m_SurfaceMolecularWeight
    );

    return output;
  }

  if( auto pm = std::dynamic_pointer_cast< const pds::DeadOilPhaseModel >( input ) )
  {
    auto output = std::make_shared< PVTPackage::DeadOil_PhaseModel >(
      convert( pm->m_type ), convert( pm->m_PVD ), pm->min_Pressure, pm->max_Pressure, pm->m_SurfaceMassDensity,
      pm->m_SurfaceMoleDensity, pm->m_SurfaceMolecularWeight
    );

    return output;
  }

  std::cerr
    << "REFACTOR - Not fully implemented | PVTPackage::PhaseModel convert( const PVTPackage::pds::PhaseModel & input )"
    << std::endl;
  exit( 1 );
}

template< typename T >
void compare( const PVTPackage::ScalarPropertyAndDerivatives< T > & actual,
              const pds::ScalarPropertyAndDerivatives< T > & expected,
              double eps )
{
  ASSERT_NEAR( actual.value, expected.value, eps );
  ASSERT_NEAR( actual.dT, expected.dT, eps );
  ASSERT_NEAR( actual.dP, expected.dP, eps );

  ASSERT_EQ( actual.dz.size(), expected.dz.size() );
  auto f = [eps]( double a,
                  double b )
  {
    return std::abs( a - b ) < eps;
  };
  bool test = std::equal( actual.dz.cbegin(), actual.dz.cend(), expected.dz.cbegin(), expected.dz.cend(), f );
  EXPECT_TRUE( test );
}

template< typename T >
void compare( const PVTPackage::VectorPropertyAndDerivatives< T > & actual,
              const pds::VectorPropertyAndDerivatives< T > & expected,
              double eps )
{
  auto f = [eps]( double a,
                  double b )
  {
    return std::abs( a - b ) < eps;
  };

  {
    ASSERT_EQ( actual.value.size(), expected.value.size() );
    bool test = std::equal( actual.value.cbegin(), actual.value.cend(),
                            expected.value.cbegin(), expected.value.cend(), f );
    EXPECT_TRUE( test );
  }
//  {
//    ASSERT_EQ( actual.dP.size(), expected.dP.size() );
//    bool test = std::equal( actual.dP.cbegin(), actual.dP.cend(),
//                            expected.dP.cbegin(), expected.dP.cend(), f );
//    EXPECT_TRUE( test );
//  }
//  {
//    ASSERT_EQ( actual.dT.size(), expected.dT.size() );
//    bool test = std::equal( actual.dT.cbegin(), actual.dT.cend(),
//                            expected.dT.cbegin(), expected.dT.cend(), f );
//    EXPECT_TRUE( test );
//  }
  // FIXME dz
  ASSERT_EQ( actual.dz.size(), expected.dz.size() );
}

using PdsPhaseType2PhaseModel = std::unordered_map< pds::PHASE_TYPE, std::shared_ptr< pds::PhaseModel >, pds::EnumClassHash >;
using PhaseType2PhaseModel = std::unordered_map< PVTPackage::PHASE_TYPE, std::shared_ptr< PVTPackage::PhaseModel >, PVTPackage::EnumClassHash >;

PhaseType2PhaseModel convert( const PdsPhaseType2PhaseModel & input )
{
  using namespace PVTPackage;

  PhaseType2PhaseModel output;

  for( const auto & phaseType2PhaseModel: input )
  {
    const PHASE_TYPE phaseType = convert( phaseType2PhaseModel.first );
    const std::shared_ptr< PhaseModel > phaseModel = convert( phaseType2PhaseModel.second );
    output.insert( { phaseType, phaseModel } );
  }

  return output;
}

void compare( const PVTPackage::MultiphaseSystemProperties & actual,
              const pds::MultiphaseSystemProperties & expected )
{
  ASSERT_NEAR( actual.Temperature, expected.Temperature, 1.e-10 );
  ASSERT_NEAR( actual.Pressure, expected.Pressure, 1.e-10 );
  ASSERT_EQ( actual.PhaseState, convert( expected.PhaseState ) );

  for( const auto & phaseType2PhaseProperties: expected.PhasesProperties )
  {
    const pds::PHASE_TYPE & pt = phaseType2PhaseProperties.first;
    const pds::PhaseProperties & expectedPhaseProps = phaseType2PhaseProperties.second;
    const PhaseProperties & actualPhaseProps = actual.PhasesProperties.at( convert( pt ) );

    ASSERT_NEAR( actualPhaseProps.Compressibility, expectedPhaseProps.Compressibility, 1.e-10 );
    ASSERT_NEAR( actualPhaseProps.Viscosity, expectedPhaseProps.Viscosity, 1.e-10 );
    ASSERT_NEAR( actualPhaseProps.MassEnthalpy, expectedPhaseProps.MassEnthalpy, 1.e-10 );

    compare( actualPhaseProps.MolecularWeight, expectedPhaseProps.MolecularWeight, 1.e10 );
    compare( actualPhaseProps.CompressibilityFactor, expectedPhaseProps.CompressibilityFactor, 1.e10 );
    compare( actualPhaseProps.MoleDensity, expectedPhaseProps.MoleDensity, 1.e10 );
    compare( actualPhaseProps.MoleComposition, expectedPhaseProps.MoleComposition, 1.e-10 );
    compare( actualPhaseProps.LnFugacityCoefficients, expectedPhaseProps.LnFugacityCoefficients, 1.e-10 );
  }

  for( const auto & phaseType2PhaseMoleFraction: expected.PhaseMoleFraction )
  {
    const pds::PHASE_TYPE & pt = phaseType2PhaseMoleFraction.first;
    const pds::ScalarPropertyAndDerivatives< double > & expectedPhaseMoleFraction = phaseType2PhaseMoleFraction.second;
    const PVTPackage::ScalarPropertyAndDerivatives< double >
      & actualPhaseMoleFraction = actual.PhaseMoleFraction.at( convert( pt ) );

    ASSERT_NEAR( expectedPhaseMoleFraction.value, actualPhaseMoleFraction.value, 1.e-10 );
  }
}

TEST( PVTPackageRefactor, cubeEoS )
{

//  json j1 = R"(
//{"PROPERTIES":{"FEED":[0.4413081711638635,0.27943529607843004,0.27232239763279725,0.006934135124909191],"PHASE_MODELS":{"GAS":{"COMPONENT_PROPERTIES":{"WATER_INDEX":3,"labels":["N2","C10","C20","H2O"],"mw":[0.028,0.134,0.275,0.018],"n_components":4,"omega":[0.04,0.443,0.816,0.344],"pc":[3400000.0,2530000.0,1460000.0,22050000.0],"tc":[126.2,622.0,782.0,647.0]},"EOS":"PENG_ROBINSON","PHASE_TYPE":"GAS"},"OIL":{"COMPONENT_PROPERTIES":{"WATER_INDEX":3,"labels":["N2","C10","C20","H2O"],"mw":[0.028,0.134,0.275,0.018],"n_components":4,"omega":[0.04,0.443,0.816,0.344],"pc":[3400000.0,2530000.0,1460000.0,22050000.0],"tc":[126.2,622.0,782.0,647.0]},"EOS":"PENG_ROBINSON","PHASE_TYPE":"OIL"}},"PHASE_MOLE_FRACTION":{"GAS":{"dP":-1.0185526175932416e-08,"dT":0.00011601642177278577,"dz":[0.6057264534307888,-0.47498921569391356,-0.48354189898750966,-0.4187787908545724],"value":0.39490059867355526},"OIL":{"dP":1.0185524550351195e-08,"dT":-0.00011601643430951906,"dz":[-0.605726470313731,0.4749892023624191,0.48354189898750966,0.41877825361636956],"value":0.6050994013264448}},"PHASE_PROPERTIES":{"GAS":{"COMPRESSIBILITY":0.0,"COMPRESSIBILITY_FACTOR":{"dP":-1.4679811217568087e-09,"dT":0.0004023412813064798,"dz":[1.1176507735201687e-05,0.00015923136975369163,0.0003742767318250315,-0.02182906265915973],"value":0.9861296916899498},"LN_FUGACITY_COEFFICIENTS":{"dP":[-2.976622093807557e-09,-1.7065627358176433e-07,-3.352299733595403e-07,-6.883826039054153e-08],"dT":[0.00044614812204968644,0.009461193749792445,0.019304269283478163,0.0031572496089093413],"dz":[[-3.060033273421912e-08,-2.6329701545842345e-07,-9.285099843795327e-07,4.7209807077516765e-05],[0.00010362749921248937,0.0010409230869363902,0.00391775810602465,-0.2024270569371459],[0.0002157640012928664,0.002166474500664176,0.008155019404611634,-0.42134517774969954],[2.975618562430963e-05,0.0002992120615163978,0.0011248137527161263,-0.05812863631271962]],"value":[-0.0172257489871612,-0.8521412571232609,-1.68723750202096,-0.32862429946083127]},"MASS_DENSITY":{"dP":1.157447256608439e-05,"dT":-0.19803289328693638,"dz":[0.00011453387987252001,0.04271709448406336,-0.03811231506387666,-0.2318118376815198],"value":52.683197166973336},"MASS_ENTHALPY":0.0,"MOLECULAR_WEIGHT":{"dP":8.139081976630443e-13,"dT":4.023092562212806e-07,"dz":[3.7775583168449816e-07,2.7228744203056396e-05,-9.629657416267658e-06,-0.0007431683215125736],"value":0.028004937477610806},"MOLE_COMPOSITION":{"dP":[7.191571322354379e-11,8.131567235316377e-13,1.5238484655939819e-15,-7.272965317084006e-11],"dT":[-2.039841844859846e-05,5.225268728375441e-06,6.364355576901417e-10,1.5172500616777392e-05],"dz":[[3.705805812502675e-05,0.0007854649902166782,0.0009798772770697006,-0.07249384861935655],[6.476191108836893e-08,0.00016704175076208847,-0.0001675048897706673,-0.00015724710367702398],[4.68999519839517e-12,-1.0844666380608691e-08,1.1302566506620626e-08,-7.158093737057163e-09],[-3.712654615421745e-05,-0.0009524851554145049,-0.0008123830211323028,0.07265120275095681]],"value":[0.9993931678757727,9.486395574952881e-05,6.147805961401386e-09,0.0005119620206717865]},"MOLE_DENSITY":{"dP":0.0004132464677290469,"dT":-7.098381174351941,"dz":[-0.021298979623085985,-0.3037174667299778,-0.7140166951891652,41.64498632451154],"value":1881.2110260589632},"VISCOSITY":0.0},"OIL":{"COMPRESSIBILITY":0.0,"COMPRESSIBILITY_FACTOR":{"dP":9.478087208487739e-08,"dT":-0.001276224430310039,"dz":[0.0003736701596725362,-0.2746866444299045,0.29853223198724876,-0.6784856477438976],"value":0.4649989533023329},"LN_FUGACITY_COEFFICIENTS":{"dP":[-2.0368303168903628e-07,-1.4525400508533775e-07,-7.052848122336623e-08,-1.9910715710033002e-07],"dT":[0.0025469133914015002,0.06435858888093145,0.12263490437806211,0.033500355218654514],"dz":[[-0.00026067262754005143,0.07655306731901125,-0.09071187559040415,0.49426344454932625],[8.968218895678454e-05,-0.03204464658820776,0.03702406716292107,-0.1682716009512545],[-5.6726685785917934e-05,0.02315200652788438,-0.026376222455421577,0.10641614322520081],[0.00039384527559937306,-0.137148335777074,0.15903609298506366,-0.7438299303594125]],"value":[2.5449468400574675,-9.342451945033686,-19.796001971601456,-3.4073581524079706]},"MASS_DENSITY":{"dP":1.7564808238636303e-08,"dT":-0.34421935858838537,"dz":[0.02518880950554893,2.503348353967836,-1.343733137854427,-49.70992026793742],"value":750.0053500173889},"MASS_ENTHALPY":0.0,"MOLECULAR_WEIGHT":{"dP":-2.6936027136715886e-09,"dT":3.0412409975213977e-05,"dz":[0.00015739122864262499,-0.11042552845427862,0.12035673362479646,-0.28676432173885075],"value":0.18799434509979238},"MOLE_COMPOSITION":{"dP":[1.5478023818948e-08,-7.771296663717763e-09,-7.575537670742356e-09,-1.3118879869580224e-10],"dT":[-0.00016352182449888496,8.510141415982033e-05,8.628738912942096e-05,-7.866969387806338e-06],"dz":[[2.291648366626796e-05,-0.005840957660814373,0.0070683207302598165,-0.043693717349259836],[0.00032158628299112045,0.8283314774275885,-0.8305962775569159,-0.781193235654662],[0.00046635751234059853,-0.8033213138712682,0.8429385589379355,-0.7615147375216054],[-0.0008108510461389723,-0.01916917714947107,-0.019410624340800126,1.5864024628054438]],"value":[0.07709016197537805,0.46173873851641745,0.4500457191133626,0.011125380394841866]},"MOLE_DENSITY":{"dP":5.725555530894867e-05,"dT":-2.4764041555986727,"dz":[-3.206049653524391,2356.7045838368717,-2561.290566140595,5821.130687121025],"value":3989.510161166104},"VISCOSITY":0.0}},"PHASE_STATE":"OIL_GAS","PHASE_TYPES":["OIL","GAS"],"PRESSURE":4583333.333333334,"TEMPERATURE":297.15}}
//)"_json;
  json j1 = R"(
  {"PROPERTIES":{"FEED":[0.099,0.3,0.6,0.001],"PHASE_MODELS":{"GAS":{"TYPE":"PHASE_MODEL_TYPE_CUBE_EOS","VALUE":{"COMPONENT_PROPERTIES":{"WATER_INDEX":18446744073709551615,"labels":["N2","C10","C20","H20"],"mw":[0.028,0.134,0.275,0.018],"n_components":4,"omega":[0.04,0.443,0.816,0.344],"pc":[3400000.0,2530000.0,1460000.0,22050000.0],"tc":[126.2,622.0,782.0,647.0]},"EOS":"PENG_ROBINSON","PHASE_TYPE":"GAS"}},"OIL":{"TYPE":"PHASE_MODEL_TYPE_CUBE_EOS","VALUE":{"COMPONENT_PROPERTIES":{"WATER_INDEX":18446744073709551615,"labels":["N2","C10","C20","H20"],"mw":[0.028,0.134,0.275,0.018],"n_components":4,"omega":[0.04,0.443,0.816,0.344],"pc":[3400000.0,2530000.0,1460000.0,22050000.0],"tc":[126.2,622.0,782.0,647.0]},"EOS":"PENG_ROBINSON","PHASE_TYPE":"OIL"}}},"PHASE_MOLE_FRACTION":{"GAS":{"dP":-1.6652469313703426e-08,"dT":0.0001996637868196638,"dz":[0.9847279717482744,-0.10366165767241728,-0.11051843366850332,-0.07863016046344543],"value":0.015389907135911748},"OIL":{"dP":1.6652469336986493e-08,"dT":-0.00019966380053171583,"dz":[-0.984727962340977,0.10366163632960934,0.1105184328924012,0.07862480543843749],"value":0.9846100928640883}},"PHASE_PROPERTIES":{"GAS":{"COMPRESSIBILITY":0.0,"COMPRESSIBILITY_FACTOR":{"dP":-1.1887580156326258e-09,"dT":0.000435740668282826,"dz":[6.020670283221494e-07,-9.819864738987647e-05,7.37110755415987e-05,-0.0148711372742463],"value":0.9857431728509369},"LN_FUGACITY_COEFFICIENTS":{"dP":[-2.8378535062074577e-09,-1.676855370402331e-07,-3.2888360917568107e-07,-6.821740865707377e-08],"dT":[0.0004829733249735669,0.010309995183037745,0.021026754957916585,0.0034509225737816415],"dz":[[-1.0348027049286941e-07,7.761021069634901e-08,-8.537123388620134e-08,3.725234788137851e-06],[5.042311362198001e-06,-0.0013269483384018969,0.0008939330554521816,-0.1392641773197454],[1.0536172995637613e-05,-0.0027601419508386676,0.0018594165181265146,-0.2896444552472942],[1.3922800029949703e-06,-0.00038294740602635313,0.0002580632701997144,-0.04021763477273624]],"value":[-0.0184373239321724,-0.9209852964896885,-1.8221738674501409,-0.35670455719116634]},"MASS_DENSITY":{"dP":1.1569380092620815e-05,"dT":-0.21819062852094304,"dz":[1.4449608679731584e-05,0.03745873583064795,-0.018587906693719163,-0.08344525925428786],"value":57.49793726757922},"MASS_ENTHALPY":0.0,"MOLECULAR_WEIGHT":{"dP":2.2067688405513697e-13,"dT":3.526191302651742e-07,"dz":[2.351824329383396e-08,1.5454521255963978e-05,-6.959307765977886e-06,-0.0004633260767746452],"value":0.028006312525132256},"MOLE_COMPOSITION":{"dP":[4.3764710426330435e-12,1.519582292530681e-12,2.407129295889369e-15,-5.899612460780173e-12],"dT":[-4.820649759627592e-06,3.4533156117550194e-06,9.41104037623444e-10,1.366374194043628e-06],"dz":[[2.1072345991275227e-06,-8.627771902691727e-05,0.00011867532832733472,-0.04555962145892592],[-6.100044354338183e-09,0.0001406937969018837,-7.023398037030721e-05,-6.722702760487639e-05],[9.980791345363722e-13,-1.015070939806197e-08,5.087103759945087e-09,-7.138627674498076e-09],[-2.081088927090706e-06,-5.4429776380319236e-05,-4.8476765195659455e-05,0.04562097596674881]],"value":[0.9998904628209397,6.384067029580275e-05,9.25746515943482e-09,4.568725129937752e-05]},"MOLE_DENSITY":{"dP":0.0004130828369140613,"dT":-7.816615225438305,"dz":[-0.0012330332740037619,0.20456948853684026,-0.15355427678539663,30.974880235191655],"value":2053.034908325822},"VISCOSITY":0.0},"OIL":{"COMPRESSIBILITY":0.0,"COMPRESSIBILITY_FACTOR":{"dP":1.0539352595806091e-07,"dT":-0.001582492161014632,"dz":[4.101581630444642e-05,-0.2553150427681683,0.1285461304449506,-0.5371863069190544],"value":0.5687798913943555},"LN_FUGACITY_COEFFICIENTS":{"dP":[-1.8506236076354925e-07,-1.269734859466549e-07,-5.195050239562973e-08,-1.8128736615180914e-07],"dT":[0.0026622037984125042,0.06420014583439652,0.12248288054014912,0.03318542776450064],"dz":[[-2.3480614104563824e-05,0.049560862304724146,-0.025230595836276914,0.26931957424321407],[2.4082681132885974e-06,-0.025573967617056388,0.012970765109589569,-0.11181664740074573],[-7.224804339865792e-06,0.006029605565984767,-0.0030481814581110713,0.018596372062384153],[1.806201084966448e-05,-0.0913319939706726,0.0463503587655634,-0.41528917418160766]],"value":[2.4475144463125194,-9.391638882884024,-19.824693371042326,-3.4574467313569794]},"MASS_DENSITY":{"dP":2.7467346191406167e-08,"dT":-0.3054439076593501,"dz":[0.0009247749555028213,0.8319345696799672,-0.3662109284050532,-30.082254376197216],"value":750.0550401195579},"MASS_ENTHALPY":0.0,"MOLECULAR_WEIGHT":{"dP":-3.09160202741622e-09,"dT":3.70628899845824e-05,"dz":[1.546559679002521e-05,-0.09439195347865655,0.04753930376124124,-0.20754773098631224],"value":0.2108032275469164},"MOLE_COMPOSITION":{"dP":[1.5474625490605785e-08,-5.152059346437439e-09,-1.0306264460086791e-08,-1.6300118295475792e-11],"dT":[-0.00018546686212374898,6.171914035667986e-05,0.00012357252405347053,1.7518772338924297e-07],"dz":[[1.693313517156045e-06,-0.004216062937375757,0.0021525502912066803,-0.02676581195277046],[-2.8372408709681288e-05,0.6788676888313051,-0.33888086455859584,-0.329012736488335],[7.292536880552034e-05,-0.6735348118576004,0.3378519704477993,-0.6580403739158226],[-4.62527411299009e-05,-0.0011168220398818682,-0.0011236647175335707,1.0138243646921263]],"value":[0.08491866906207245,0.30468813967299374,0.6093782749191767,0.0010149163457571287]},"MOLE_DENSITY":{"dP":5.231247558593734e-05,"dT":-2.074525599702201,"dz":[-0.2567791793112834,1597.1585306943193,-804.1381636227627,3360.423558599374],"value":3558.081386361248},"VISCOSITY":0.0}},"PHASE_STATE":"OIL_GAS","PHASE_TYPES":["OIL","GAS"],"PRESSURE":5000000.0,"TEMPERATURE":297.15}}
  )"_json;

  json const & refProperties = j1["PROPERTIES"];

  pds::MultiphaseSystemProperties
    refMsp = refProperties.get< pds::MultiphaseSystemProperties >();

  // TODO Check that all ComponentProperties are the same.
  std::shared_ptr< pds::CubicEoSPhaseModel > pm =
    std::dynamic_pointer_cast< pds::CubicEoSPhaseModel >( refMsp.PhaseModels.at( refMsp.PhaseTypes[0] ) );
  const pds::ComponentProperties & componentProperties = pm->m_ComponentsProperties;
  componentProperties.Label.size();

  PVTPackage::MultiphaseSystemProperties msp( convert( refMsp.PhaseTypes ), refMsp.Feed.size() );
  msp.Temperature = refMsp.Temperature;
  msp.Pressure = refMsp.Pressure;
  msp.Feed = refMsp.Feed;

  msp.PhaseModels = convert( refMsp.PhaseModels );
  // the PhaseMoleFraction and PhasesProperties seem to be the results, so no need to copy.

  PVTPackage::NegativeTwoPhaseFlash flash( convert( componentProperties ) );
  flash.ComputeEquilibrium( msp );

  compare( msp, refMsp );
}


TEST( PVTPackageRefactor, blackOil )
{
  // This is blackoil
  json j1 = R"(
  {"PROPERTIES":{"FEED":[0.01656314691054962,0.35403727048856476,0.6293995826008856],"PHASE_MODELS":{"GAS":{"TYPE":"PHASE_MODEL_TYPE_BLACK_OIL_GAS","VALUE":{"MAX_PRESSURE":53000000.0,"MIN_PRESSURE":101325.0,"PVTG_DATA":{"DEW_PRESSURE":[101325.0,3000000.0,6000000.0,9000000.0,12000000.0,15000000.0,18000000.0,21000000.0,24000000.0,27000000.0,29500000.0,31000000.0,33000000.0,53000000.0],"MAX_RELATIVE_RV":0.0,"MIN_RELATIVE_RV":0.0,"N_SATURATED_POINTS":14,"RV":[0.0,0.000132,0.000124,0.000126,0.000135,0.000149,0.000163,0.000191,0.000225,0.000272,0.000354,0.000403,0.000354,0.000479],"SATURATED_BG":[1.0,0.04234,0.02046,0.01328,0.00977,0.00773,0.006426,0.005541,0.004919,0.004471,0.004194,0.004031,0.00391,0.003868],"SATURATED_VISCOSITY":[1.027145211270172e-05,1.344e-05,1.42e-05,1.526e-05,1.66e-05,1.818e-05,1.994e-05,2.181e-05,2.37e-05,2.559e-05,2.714e-05,2.806e-05,2.832e-05,2.935e-05],"UNDERSATURATED_BG":[[1.0],[0.04234],[0.02046],[0.01328],[0.00977],[0.00773],[0.006426],[0.005541],[0.004919],[0.004471],[0.004194],[0.004031],[0.00391],[0.003868]],"UNDERSATURATED_RV":[[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0],[0.0]],"UNDERSATURATED_VISCOSITY":[[1.027145211270172e-05],[1.344e-05],[1.42e-05],[1.526e-05],[1.66e-05],[1.818e-05],[1.994e-05],[2.181e-05],[2.37e-05],[2.559e-05],[2.714e-05],[2.806e-05],[2.832e-05],[2.935e-05]]},"SURFACE_MASS_DENSITY":0.9907,"SURFACE_MOLECULAR_WEIGHT":0.016,"SURFACE_MOLE_DENSITY":61.91875}},"LIQUID_WATER_RICH":{"TYPE":"PHASE_MODEL_TYPE_BLACK_OIL_WATER","VALUE":{"PVTW_DATA":{"BW":1.03,"COMPRESSIBILITY":4.1e-10,"REFERENCE_PRESSURE":30600000.1,"VISCOSITY":0.0003},"SURFACE_MASS_DENSITY":1022.0,"SURFACE_MOLECULAR_WEIGHT":0.018,"SURFACE_MOLE_DENSITY":56777.77777777778}},"OIL":{"TYPE":"PHASE_MODEL_TYPE_BLACK_OIL_OIL","VALUE":{"MAX_PRESSURE":50000000.7,"MIN_PRESSURE":101325.0,"PVTO_DATA":{"BUBBLE_PRESSURE":[101325.0,2000000.0,5000000.0,10000000.0,20000000.0,30000000.0,40000000.0,50000000.7],"MAX_RELATIVE_PRESSURE":70000000.0,"MIN_RELATIVE_PRESSURE":70000000.0,"N_SATURATED_POINTS":8,"RS":[0.0,2.0,5.0,10.0,15.0,30.0,40.0,50.0],"SATURATED_BO":[1.0,1.02,1.03,1.04,1.05,1.07,1.08,1.09],"SATURATED_VISCOSITY":[0.0012204958651610789,0.000975,0.00091,0.00083,0.000695,0.000594,0.00051,0.000449],"UNDERSATURATED_BO":[[1.0,0.9997979797979797,0.9995959595959596,0.9993939393939393,0.9991919191919192,0.998989898989899,0.9987878787878788,0.9985858585858586,0.9983838383838384,0.9981818181818182,0.997979797979798,0.9977777777777779,0.9975757575757576,0.9973737373737375,0.9971717171717172,0.996969696969697,0.9967676767676767,0.9965656565656565,0.9963636363636365,0.9961616161616161,0.9959595959595959,0.9957575757575757,0.9955555555555555,0.9953535353535354,0.9951515151515151,0.994949494949495,0.9947474747474747,0.9945454545454545,0.9943434343434343,0.994141414141414,0.9939393939393939,0.9937373737373738,0.9935353535353536,0.9933333333333334,0.9931313131313131,0.992929292929293,0.9927272727272727,0.9925252525252526,0.9923232323232323,0.9921212121212122,0.9919191919191919,0.9917171717171716,0.9915151515151515,0.9913131313131311,0.9911111111111112,0.990909090909091,0.9907070707070708,0.9905050505050506,0.9903030303030302,0.9901010101010101,0.9898989898989898,0.9896969696969697,0.9894949494949495,0.9892929292929293,0.9890909090909091,0.9888888888888889,0.9886868686868687,0.9884848484848485,0.9882828282828282,0.9880808080808081,0.987878787878788,0.9876767676767677,0.9874747474747476,0.9872727272727273,0.9870707070707071,0.9868686868686869,0.9866666666666667,0.9864646464646465,0.9862626262626263,0.9860606060606061,0.9858585858585858,0.9856565656565657,0.9854545454545454,0.9852525252525253,0.9850505050505052,0.9848484848484849,0.9846464646464647,0.9844444444444445,0.9842424242424243,0.984040404040404,0.9838383838383838,0.9836363636363636,0.9834343434343434,0.9832323232323232,0.983030303030303,0.9828282828282828,0.9826262626262625,0.9824242424242424,0.9822222222222222,0.982020202020202,0.9818181818181818,0.9816161616161616,0.9814141414141414,0.9812121212121212,0.981010101010101,0.9808080808080808,0.9806060606060606,0.9804040404040404,0.9802020202020202,0.98],[1.02,1.0197979797979797,1.0195959595959594,1.0193939393939395,1.0191919191919192,1.018989898989899,1.0187878787878788,1.0185858585858585,1.0183838383838384,1.018181818181818,1.017979797979798,1.017777777777778,1.0175757575757576,1.0173737373737373,1.0171717171717172,1.016969696969697,1.0167676767676768,1.0165656565656567,1.0163636363636364,1.0161616161616163,1.015959595959596,1.0157575757575756,1.0155555555555555,1.0153535353535355,1.0151515151515151,1.014949494949495,1.014747474747475,1.0145454545454546,1.0143434343434343,1.014141414141414,1.013939393939394,1.0137373737373738,1.0135353535353535,1.0133333333333334,1.0131313131313133,1.012929292929293,1.0127272727272727,1.0125252525252526,1.0123232323232323,1.0121212121212122,1.0119191919191919,1.0117171717171716,1.0115151515151515,1.0113131313131314,1.011111111111111,1.010909090909091,1.0107070707070707,1.0105050505050506,1.0103030303030303,1.01010101010101,1.0098989898989899,1.0096969696969698,1.0094949494949494,1.0092929292929291,1.009090909090909,1.008888888888889,1.0086868686868686,1.0084848484848485,1.0082828282828282,1.0080808080808081,1.0078787878787878,1.0076767676767677,1.0074747474747476,1.0072727272727273,1.007070707070707,1.0068686868686867,1.0066666666666668,1.0064646464646465,1.0062626262626262,1.006060606060606,1.0058585858585858,1.0056565656565657,1.0054545454545454,1.0052525252525253,1.0050505050505052,1.0048484848484849,1.0046464646464646,1.0044444444444445,1.0042424242424244,1.004040404040404,1.0038383838383838,1.0036363636363637,1.0034343434343433,1.0032323232323233,1.003030303030303,1.0028282828282828,1.0026262626262625,1.0024242424242424,1.0022222222222223,1.002020202020202,1.001818181818182,1.0016161616161616,1.0014141414141413,1.0012121212121212,1.001010101010101,1.0008080808080808,1.0006060606060605,1.0004040404040404,1.00020202020202,1.0],[1.03,1.0297979797979797,1.0295959595959596,1.0293939393939393,1.0291919191919192,1.0289898989898991,1.0287878787878788,1.0285858585858587,1.0283838383838384,1.0281818181818183,1.027979797979798,1.027777777777778,1.0275757575757576,1.0273737373737375,1.0271717171717172,1.0269696969696969,1.0267676767676768,1.0265656565656567,1.0263636363636364,1.026161616161616,1.025959595959596,1.0257575757575756,1.0255555555555558,1.0253535353535355,1.0251515151515151,1.024949494949495,1.0247474747474747,1.0245454545454544,1.0243434343434343,1.024141414141414,1.023939393939394,1.0237373737373738,1.0235353535353535,1.0233333333333334,1.0231313131313131,1.022929292929293,1.022727272727273,1.0225252525252526,1.0223232323232323,1.0221212121212122,1.0219191919191921,1.0217171717171718,1.0215151515151515,1.0213131313131312,1.021111111111111,1.020909090909091,1.0207070707070707,1.0205050505050506,1.0203030303030303,1.0201010101010102,1.0198989898989899,1.0196969696969695,1.0194949494949495,1.0192929292929294,1.019090909090909,1.018888888888889,1.0186868686868689,1.0184848484848485,1.0182828282828282,1.018080808080808,1.017878787878788,1.0176767676767677,1.0174747474747474,1.017272727272727,1.0170707070707072,1.016868686868687,1.0166666666666666,1.0164646464646465,1.0162626262626264,1.016060606060606,1.0158585858585858,1.0156565656565657,1.0154545454545454,1.0152525252525253,1.0150505050505052,1.0148484848484849,1.0146464646464648,1.0144444444444445,1.0142424242424244,1.014040404040404,1.013838383838384,1.0136363636363637,1.0134343434343434,1.0132323232323233,1.0130303030303032,1.0128282828282829,1.0126262626262625,1.0124242424242424,1.0122222222222224,1.012020202020202,1.011818181818182,1.0116161616161616,1.0114141414141415,1.0112121212121212,1.0110101010101011,1.0108080808080808,1.0106060606060607,1.0104040404040404,1.01020202020202,1.01],[1.04,1.0397979797979797,1.0395959595959596,1.0393939393939395,1.039191919191919,1.0389898989898991,1.0387878787878788,1.0385858585858585,1.0383838383838384,1.038181818181818,1.0379797979797982,1.0377777777777777,1.0375757575757576,1.0373737373737375,1.0371717171717172,1.036969696969697,1.0367676767676768,1.0365656565656565,1.0363636363636364,1.0361616161616163,1.035959595959596,1.0357575757575759,1.0355555555555556,1.0353535353535355,1.0351515151515152,1.034949494949495,1.0347474747474747,1.0345454545454547,1.0343434343434343,1.034141414141414,1.033939393939394,1.0337373737373738,1.0335353535353535,1.0333333333333334,1.0331313131313131,1.032929292929293,1.0327272727272727,1.0325252525252524,1.0323232323232323,1.0321212121212122,1.031919191919192,1.0317171717171718,1.0315151515151513,1.0313131313131312,1.031111111111111,1.030909090909091,1.030707070707071,1.0305050505050506,1.0303030303030303,1.03010101010101,1.02989898989899,1.0296969696969698,1.0294949494949495,1.0292929292929291,1.029090909090909,1.028888888888889,1.0286868686868686,1.0284848484848486,1.0282828282828282,1.0280808080808082,1.0278787878787878,1.0276767676767675,1.0274747474747474,1.0272727272727273,1.027070707070707,1.0268686868686867,1.0266666666666666,1.0264646464646465,1.0262626262626262,1.0260606060606061,1.0258585858585858,1.0256565656565657,1.0254545454545454,1.025252525252525,1.0250505050505052,1.024848484848485,1.0246464646464646,1.0244444444444445,1.0242424242424242,1.024040404040404,1.0238383838383838,1.0236363636363637,1.0234343434343434,1.0232323232323233,1.023030303030303,1.0228282828282829,1.0226262626262625,1.0224242424242425,1.0222222222222224,1.022020202020202,1.021818181818182,1.0216161616161616,1.0214141414141413,1.0212121212121212,1.021010101010101,1.0208080808080808,1.0206060606060605,1.0204040404040404,1.02020202020202,1.02],[1.05,1.04979797979798,1.0495959595959596,1.0493939393939393,1.0491919191919192,1.0489898989898991,1.0487878787878788,1.0485858585858587,1.0483838383838384,1.0481818181818183,1.047979797979798,1.0477777777777777,1.0475757575757576,1.0473737373737373,1.0471717171717172,1.0469696969696969,1.0467676767676768,1.0465656565656567,1.0463636363636364,1.0461616161616163,1.045959595959596,1.0457575757575759,1.0455555555555556,1.0453535353535355,1.0451515151515152,1.044949494949495,1.0447474747474748,1.0445454545454547,1.0443434343434344,1.0441414141414143,1.043939393939394,1.0437373737373736,1.0435353535353535,1.0433333333333334,1.0431313131313134,1.042929292929293,1.0427272727272727,1.0425252525252526,1.0423232323232323,1.0421212121212122,1.041919191919192,1.0417171717171718,1.0415151515151515,1.0413131313131312,1.0411111111111113,1.040909090909091,1.0407070707070707,1.0405050505050506,1.0403030303030305,1.0401010101010102,1.0398989898989899,1.0396969696969696,1.0394949494949495,1.0392929292929294,1.039090909090909,1.038888888888889,1.0386868686868687,1.0384848484848486,1.0382828282828283,1.0380808080808082,1.037878787878788,1.0376767676767678,1.0374747474747474,1.0372727272727273,1.0370707070707073,1.036868686868687,1.0366666666666666,1.0364646464646465,1.0362626262626262,1.0360606060606061,1.0358585858585858,1.0356565656565657,1.0354545454545454,1.0352525252525253,1.0350505050505052,1.0348484848484847,1.0346464646464648,1.0344444444444445,1.0342424242424242,1.0340404040404039,1.033838383838384,1.0336363636363637,1.0334343434343434,1.0332323232323233,1.033030303030303,1.0328282828282829,1.0326262626262626,1.0324242424242425,1.0322222222222224,1.032020202020202,1.031818181818182,1.0316161616161617,1.0314141414141416,1.0312121212121212,1.0310101010101012,1.0308080808080808,1.0306060606060607,1.0304040404040404,1.0302020202020203,1.03],[1.07,1.0698088023088022,1.0696176046176047,1.0694264069264068,1.0692352092352095,1.0690440115440116,1.068852813852814,1.068661616161616,1.0684704184704183,1.0682792207792207,1.0680880230880232,1.0678968253968255,1.0677056277056278,1.0675144300144301,1.0673232323232322,1.0671320346320345,1.066940836940837,1.0667496392496394,1.0665584415584417,1.0663672438672438,1.0661760461760463,1.0659848484848484,1.0657936507936507,1.065602453102453,1.0654112554112556,1.0652200577200577,1.06502886002886,1.0648376623376623,1.0646464646464646,1.064455266955267,1.0642640692640692,1.0640728715728716,1.0638816738816739,1.0636904761904762,1.0634992784992785,1.0633080808080808,1.0631168831168831,1.0629256854256854,1.0627344877344878,1.06254329004329,1.0623520923520924,1.0621608946608947,1.061969696969697,1.0617784992784993,1.0615873015873016,1.061396103896104,1.0612049062049063,1.0610137085137086,1.0608225108225109,1.0606313131313132,1.0604401154401155,1.0602489177489178,1.0600577200577201,1.0598665223665225,1.0596753246753248,1.059484126984127,1.0592929292929294,1.0591017316017315,1.058910533910534,1.0587193362193363,1.0585281385281387,1.058336940836941,1.058145743145743,1.0579545454545456,1.057763347763348,1.05757215007215,1.0573809523809525,1.0571897546897548,1.0569985569985572,1.0568073593073595,1.0566161616161618,1.0564249639249639,1.0562337662337664,1.0560425685425687,1.055851370851371,1.0556601731601731,1.0554689754689757,1.055277777777778,1.05508658008658,1.0548953823953824,1.0547041847041847,1.0545129870129872,1.0543217893217893,1.0541305916305916,1.053939393939394,1.0537481962481963,1.0535569985569986,1.053365800865801,1.0531746031746032,1.0529834054834055,1.0527922077922078,1.0526010101010101,1.0524098124098125,1.0522186147186148,1.052027417027417,1.0518362193362194,1.0516450216450217,1.0514538239538238,1.0512626262626266,1.0510714285714287],[1.08,1.0792929292929296,1.0785858585858588,1.077878787878788,1.0771717171717172,1.0764646464646466,1.075757575757576,1.075050505050505,1.0743434343434344,1.0736363636363637,1.072929292929293,1.0722222222222224,1.0715151515151515,1.0708080808080809,1.0701010101010102,1.0698484848484848,1.0696717171717172,1.0694949494949497,1.069318181818182,1.0691414141414142,1.0689646464646465,1.0687878787878788,1.0686111111111112,1.0684343434343435,1.0682575757575759,1.0680808080808082,1.0679040404040405,1.0677272727272729,1.0675505050505052,1.0673737373737375,1.0671969696969699,1.0670202020202022,1.0668434343434345,1.0666666666666667,1.066489898989899,1.0663131313131313,1.0661363636363637,1.065959595959596,1.0657828282828283,1.0656060606060607,1.065429292929293,1.0652525252525251,1.0650757575757577,1.06489898989899,1.0647222222222223,1.0645454545454545,1.0643686868686868,1.0641919191919191,1.0640151515151515,1.0638383838383838,1.0636616161616161,1.0634848484848487,1.0633080808080808,1.0631313131313131,1.0629545454545455,1.0627777777777778,1.0626010101010102,1.0624242424242425,1.0622474747474748,1.0620707070707072,1.0618939393939395,1.0617171717171718,1.061540404040404,1.0613636363636365,1.0611868686868688,1.061010101010101,1.0608333333333333,1.0606565656565656,1.060479797979798,1.0603030303030305,1.0601262626262626,1.059949494949495,1.0597727272727275,1.0595959595959599,1.059419191919192,1.0592424242424243,1.0590656565656567,1.058888888888889,1.0587121212121213,1.0585353535353537,1.0583585858585858,1.0581818181818183,1.0580050505050504,1.0578282828282828,1.0576515151515151,1.0574747474747475,1.05729797979798,1.0571212121212121,1.0569444444444445,1.0567676767676768,1.0565909090909091,1.0564141414141417,1.0562373737373738,1.0560606060606061,1.0558838383838385,1.0557070707070708,1.0555303030303032,1.0553535353535355,1.0551767676767678,1.0550000000000002],[1.09,1.0898232323232324,1.0896464646464645,1.089469696969697,1.0892929292929294,1.0891161616161618,1.088939393939394,1.0887626262626264,1.0885858585858585,1.0884090909090909,1.0882323232323232,1.0880555555555556,1.087878787878788,1.0877020202020202,1.0875252525252526,1.087348484848485,1.0871717171717172,1.0869949494949496,1.086818181818182,1.0866414141414142,1.0864646464646466,1.086287878787879,1.0861111111111112,1.0859343434343436,1.0857575757575757,1.0855808080808083,1.0854040404040404,1.085227272727273,1.0850505050505053,1.0848737373737376,1.08469696969697,1.0845202020202023,1.0843434343434344,1.0841666666666667,1.083989898989899,1.0838131313131314,1.0836363636363637,1.083459595959596,1.0832828282828282,1.0831060606060605,1.082929292929293,1.0827525252525254,1.0825757575757575,1.0823989898989899,1.0822222222222222,1.0820454545454545,1.081868686868687,1.0816919191919192,1.0815151515151515,1.0813383838383839,1.0811616161616162,1.0809848484848485,1.0808080808080809,1.0806313131313132,1.0804545454545456,1.080277777777778,1.0801010101010102,1.0799242424242426,1.0797474747474747,1.079570707070707,1.0793939393939396,1.079217171717172,1.079040404040404,1.0788636363636364,1.0786868686868687,1.078510101010101,1.0783333333333334,1.078156565656566,1.0779797979797978,1.0778030303030304,1.0776262626262625,1.077449494949495,1.0772727272727274,1.0770959595959595,1.076919191919192,1.0767424242424242,1.0765656565656567,1.0763888888888888,1.0762121212121212,1.0760353535353535,1.0758585858585858,1.0756818181818182,1.0755050505050505,1.0753282828282829,1.0751515151515152,1.0749747474747475,1.0747979797979799,1.0746212121212122,1.0744444444444445,1.0742676767676769,1.0740909090909092,1.0739141414141415,1.0737373737373737,1.073560606060606,1.0733838383838386,1.0732070707070707,1.073030303030303,1.0728535353535353,1.0726767676767677,1.0725]],"UNDERSATURATED_PRESSURE":[[0.0,707070.7070707071,1414141.4141414142,2121212.121212121,2828282.8282828284,3535353.535353536,4242424.242424242,4949494.94949495,5656565.656565657,6363636.363636364,7070707.070707072,7777777.777777778,8484848.484848484,9191919.191919193,9898989.8989899,10606060.606060607,11313131.313131314,12020202.02020202,12727272.727272728,13434343.434343435,14141414.141414143,14848484.84848485,15555555.555555556,16262626.262626264,16969696.96969697,17676767.676767677,18383838.383838385,19090909.090909094,19797979.7979798,20505050.505050506,21212121.212121215,21919191.91919192,22626262.626262628,23333333.333333336,24040404.04040404,24747474.74747475,25454545.454545457,26161616.16161616,26868686.86868687,27575757.575757578,28282828.282828286,28989898.98989899,29696969.6969697,30404040.404040407,31111111.111111112,31818181.81818182,32525252.52525253,33232323.232323233,33939393.93939394,34646464.646464646,35353535.353535354,36060606.06060606,36767676.76767677,37474747.47474748,38181818.18181819,38888888.88888889,39595959.5959596,40303030.303030305,41010101.01010101,41717171.71717172,42424242.42424243,43131313.13131313,43838383.83838384,44545454.54545455,45252525.252525255,45959595.95959596,46666666.66666667,47373737.37373738,48080808.08080808,48787878.78787879,49494949.4949495,50202020.202020206,50909090.909090914,51616161.61616162,52323232.32323232,53030303.03030303,53737373.73737374,54444444.44444445,55151515.151515156,55858585.858585864,56565656.56565657,57272727.27272727,57979797.97979798,58686868.68686869,59393939.3939394,60101010.10101011,60808080.808080815,61515151.515151516,62222222.222222224,62929292.92929293,63636363.63636364,64343434.34343435,65050505.05050506,65757575.75757576,66464646.464646466,67171717.17171718,67878787.87878788,68585858.58585858,69292929.29292929,70000000.0],[0.0,707070.7070707071,1414141.4141414142,2121212.121212121,2828282.8282828284,3535353.535353536,4242424.242424242,4949494.94949495,5656565.656565657,6363636.363636364,7070707.070707072,7777777.777777778,8484848.484848484,9191919.191919193,9898989.8989899,10606060.606060607,11313131.313131314,12020202.02020202,12727272.727272728,13434343.434343435,14141414.141414143,14848484.84848485,15555555.555555556,16262626.262626264,16969696.96969697,17676767.676767677,18383838.383838385,19090909.090909094,19797979.7979798,20505050.505050506,21212121.212121215,21919191.91919192,22626262.626262628,23333333.333333336,24040404.04040404,24747474.74747475,25454545.454545457,26161616.16161616,26868686.86868687,27575757.575757578,28282828.282828286,28989898.98989899,29696969.6969697,30404040.404040407,31111111.111111112,31818181.81818182,32525252.52525253,33232323.232323233,33939393.93939394,34646464.646464646,35353535.353535354,36060606.06060606,36767676.76767677,37474747.47474748,38181818.18181819,38888888.88888889,39595959.5959596,40303030.303030305,41010101.01010101,41717171.71717172,42424242.42424243,43131313.13131313,43838383.83838384,44545454.54545455,45252525.252525255,45959595.95959596,46666666.66666667,47373737.37373738,48080808.08080808,48787878.78787879,49494949.4949495,50202020.202020206,50909090.909090914,51616161.61616162,52323232.32323232,53030303.03030303,53737373.73737374,54444444.44444445,55151515.151515156,55858585.858585864,56565656.56565657,57272727.27272727,57979797.97979798,58686868.68686869,59393939.3939394,60101010.10101011,60808080.808080815,61515151.515151516,62222222.222222224,62929292.92929293,63636363.63636364,64343434.34343435,65050505.05050506,65757575.75757576,66464646.464646466,67171717.17171718,67878787.87878788,68585858.58585858,69292929.29292929,70000000.0],[0.0,707070.7070707071,1414141.4141414142,2121212.121212121,2828282.8282828284,3535353.535353536,4242424.242424242,4949494.94949495,5656565.656565657,6363636.363636364,7070707.070707072,7777777.777777778,8484848.484848484,9191919.191919193,9898989.8989899,10606060.606060607,11313131.313131314,12020202.02020202,12727272.727272728,13434343.434343435,14141414.141414143,14848484.84848485,15555555.555555556,16262626.262626264,16969696.96969697,17676767.676767677,18383838.383838385,19090909.090909094,19797979.7979798,20505050.505050506,21212121.212121215,21919191.91919192,22626262.626262628,23333333.333333336,24040404.04040404,24747474.74747475,25454545.454545457,26161616.16161616,26868686.86868687,27575757.575757578,28282828.282828286,28989898.98989899,29696969.6969697,30404040.404040407,31111111.111111112,31818181.81818182,32525252.52525253,33232323.232323233,33939393.93939394,34646464.646464646,35353535.353535354,36060606.06060606,36767676.76767677,37474747.47474748,38181818.18181819,38888888.88888889,39595959.5959596,40303030.303030305,41010101.01010101,41717171.71717172,42424242.42424243,43131313.13131313,43838383.83838384,44545454.54545455,45252525.252525255,45959595.95959596,46666666.66666667,47373737.37373738,48080808.08080808,48787878.78787879,49494949.4949495,50202020.202020206,50909090.909090914,51616161.61616162,52323232.32323232,53030303.03030303,53737373.73737374,54444444.44444445,55151515.151515156,55858585.858585864,56565656.56565657,57272727.27272727,57979797.97979798,58686868.68686869,59393939.3939394,60101010.10101011,60808080.808080815,61515151.515151516,62222222.222222224,62929292.92929293,63636363.63636364,64343434.34343435,65050505.05050506,65757575.75757576,66464646.464646466,67171717.17171718,67878787.87878788,68585858.58585858,69292929.29292929,70000000.0],[0.0,707070.7070707071,1414141.4141414142,2121212.121212121,2828282.8282828284,3535353.535353536,4242424.242424242,4949494.94949495,5656565.656565657,6363636.363636364,7070707.070707072,7777777.777777778,8484848.484848484,9191919.191919193,9898989.8989899,10606060.606060607,11313131.313131314,12020202.02020202,12727272.727272728,13434343.434343435,14141414.141414143,14848484.84848485,15555555.555555556,16262626.262626264,16969696.96969697,17676767.676767677,18383838.383838385,19090909.090909094,19797979.7979798,20505050.505050506,21212121.212121215,21919191.91919192,22626262.626262628,23333333.333333336,24040404.04040404,24747474.74747475,25454545.454545457,26161616.16161616,26868686.86868687,27575757.575757578,28282828.282828286,28989898.98989899,29696969.6969697,30404040.404040407,31111111.111111112,31818181.81818182,32525252.52525253,33232323.232323233,33939393.93939394,34646464.646464646,35353535.353535354,36060606.06060606,36767676.76767677,37474747.47474748,38181818.18181819,38888888.88888889,39595959.5959596,40303030.303030305,41010101.01010101,41717171.71717172,42424242.42424243,43131313.13131313,43838383.83838384,44545454.54545455,45252525.252525255,45959595.95959596,46666666.66666667,47373737.37373738,48080808.08080808,48787878.78787879,49494949.4949495,50202020.202020206,50909090.909090914,51616161.61616162,52323232.32323232,53030303.03030303,53737373.73737374,54444444.44444445,55151515.151515156,55858585.858585864,56565656.56565657,57272727.27272727,57979797.97979798,58686868.68686869,59393939.3939394,60101010.10101011,60808080.808080815,61515151.515151516,62222222.222222224,62929292.92929293,63636363.63636364,64343434.34343435,65050505.05050506,65757575.75757576,66464646.464646466,67171717.17171718,67878787.87878788,68585858.58585858,69292929.29292929,70000000.0],[0.0,707070.7070707071,1414141.4141414142,2121212.121212121,2828282.8282828284,3535353.535353536,4242424.242424242,4949494.94949495,5656565.656565657,6363636.363636364,7070707.070707072,7777777.777777778,8484848.484848484,9191919.191919193,9898989.8989899,10606060.606060607,11313131.313131314,12020202.02020202,12727272.727272728,13434343.434343435,14141414.141414143,14848484.84848485,15555555.555555556,16262626.262626264,16969696.96969697,17676767.676767677,18383838.383838385,19090909.090909094,19797979.7979798,20505050.505050506,21212121.212121215,21919191.91919192,22626262.626262628,23333333.333333336,24040404.04040404,24747474.74747475,25454545.454545457,26161616.16161616,26868686.86868687,27575757.575757578,28282828.282828286,28989898.98989899,29696969.6969697,30404040.404040407,31111111.111111112,31818181.81818182,32525252.52525253,33232323.232323233,33939393.93939394,34646464.646464646,35353535.353535354,36060606.06060606,36767676.76767677,37474747.47474748,38181818.18181819,38888888.88888889,39595959.5959596,40303030.303030305,41010101.01010101,41717171.71717172,42424242.42424243,43131313.13131313,43838383.83838384,44545454.54545455,45252525.252525255,45959595.95959596,46666666.66666667,47373737.37373738,48080808.08080808,48787878.78787879,49494949.4949495,50202020.202020206,50909090.909090914,51616161.61616162,52323232.32323232,53030303.03030303,53737373.73737374,54444444.44444445,55151515.151515156,55858585.858585864,56565656.56565657,57272727.27272727,57979797.97979798,58686868.68686869,59393939.3939394,60101010.10101011,60808080.808080815,61515151.515151516,62222222.222222224,62929292.92929293,63636363.63636364,64343434.34343435,65050505.05050506,65757575.75757576,66464646.464646466,67171717.17171718,67878787.87878788,68585858.58585858,69292929.29292929,70000000.0],[0.0,707070.7070707071,1414141.4141414142,2121212.121212121,2828282.8282828284,3535353.535353536,4242424.242424242,4949494.94949495,5656565.656565657,6363636.363636364,7070707.070707072,7777777.777777778,8484848.484848484,9191919.191919193,9898989.8989899,10606060.606060607,11313131.313131314,12020202.02020202,12727272.727272728,13434343.434343435,14141414.141414143,14848484.84848485,15555555.555555556,16262626.262626264,16969696.96969697,17676767.676767677,18383838.383838385,19090909.090909094,19797979.7979798,20505050.505050506,21212121.212121215,21919191.91919192,22626262.626262628,23333333.333333336,24040404.04040404,24747474.74747475,25454545.454545457,26161616.16161616,26868686.86868687,27575757.575757578,28282828.282828286,28989898.98989899,29696969.6969697,30404040.404040407,31111111.111111112,31818181.81818182,32525252.52525253,33232323.232323233,33939393.93939394,34646464.646464646,35353535.353535354,36060606.06060606,36767676.76767677,37474747.47474748,38181818.18181819,38888888.88888889,39595959.5959596,40303030.303030305,41010101.01010101,41717171.71717172,42424242.42424243,43131313.13131313,43838383.83838384,44545454.54545455,45252525.252525255,45959595.95959596,46666666.66666667,47373737.37373738,48080808.08080808,48787878.78787879,49494949.4949495,50202020.202020206,50909090.909090914,51616161.61616162,52323232.32323232,53030303.03030303,53737373.73737374,54444444.44444445,55151515.151515156,55858585.858585864,56565656.56565657,57272727.27272727,57979797.97979798,58686868.68686869,59393939.3939394,60101010.10101011,60808080.808080815,61515151.515151516,62222222.222222224,62929292.92929293,63636363.63636364,64343434.34343435,65050505.05050506,65757575.75757576,66464646.464646466,67171717.17171718,67878787.87878788,68585858.58585858,69292929.29292929,70000000.0],[0.0,707070.7070707071,1414141.4141414142,2121212.121212121,2828282.8282828284,3535353.535353536,4242424.242424242,4949494.94949495,5656565.656565657,6363636.363636364,7070707.070707072,7777777.777777778,8484848.484848484,9191919.191919193,9898989.8989899,10606060.606060607,11313131.313131314,12020202.02020202,12727272.727272728,13434343.434343435,14141414.141414143,14848484.84848485,15555555.555555556,16262626.262626264,16969696.96969697,17676767.676767677,18383838.383838385,19090909.090909094,19797979.7979798,20505050.505050506,21212121.212121215,21919191.91919192,22626262.626262628,23333333.333333336,24040404.04040404,24747474.74747475,25454545.454545457,26161616.16161616,26868686.86868687,27575757.575757578,28282828.282828286,28989898.98989899,29696969.6969697,30404040.404040407,31111111.111111112,31818181.81818182,32525252.52525253,33232323.232323233,33939393.93939394,34646464.646464646,35353535.353535354,36060606.06060606,36767676.76767677,37474747.47474748,38181818.18181819,38888888.88888889,39595959.5959596,40303030.303030305,41010101.01010101,41717171.71717172,42424242.42424243,43131313.13131313,43838383.83838384,44545454.54545455,45252525.252525255,45959595.95959596,46666666.66666667,47373737.37373738,48080808.08080808,48787878.78787879,49494949.4949495,50202020.202020206,50909090.909090914,51616161.61616162,52323232.32323232,53030303.03030303,53737373.73737374,54444444.44444445,55151515.151515156,55858585.858585864,56565656.56565657,57272727.27272727,57979797.97979798,58686868.68686869,59393939.3939394,60101010.10101011,60808080.808080815,61515151.515151516,62222222.222222224,62929292.92929293,63636363.63636364,64343434.34343435,65050505.05050506,65757575.75757576,66464646.464646466,67171717.17171718,67878787.87878788,68585858.58585858,69292929.29292929,70000000.0],[0.0,707070.7070707071,1414141.4141414142,2121212.121212121,2828282.8282828284,3535353.535353536,4242424.242424242,4949494.94949495,5656565.656565657,6363636.363636364,7070707.070707072,7777777.777777778,8484848.484848484,9191919.191919193,9898989.8989899,10606060.606060607,11313131.313131314,12020202.02020202,12727272.727272728,13434343.434343435,14141414.141414143,14848484.84848485,15555555.555555556,16262626.262626264,16969696.96969697,17676767.676767677,18383838.383838385,19090909.090909094,19797979.7979798,20505050.505050506,21212121.212121215,21919191.91919192,22626262.626262628,23333333.333333336,24040404.04040404,24747474.74747475,25454545.454545457,26161616.16161616,26868686.86868687,27575757.575757578,28282828.282828286,28989898.98989899,29696969.6969697,30404040.404040407,31111111.111111112,31818181.81818182,32525252.52525253,33232323.232323233,33939393.93939394,34646464.646464646,35353535.353535354,36060606.06060606,36767676.76767677,37474747.47474748,38181818.18181819,38888888.88888889,39595959.5959596,40303030.303030305,41010101.01010101,41717171.71717172,42424242.42424243,43131313.13131313,43838383.83838384,44545454.54545455,45252525.252525255,45959595.95959596,46666666.66666667,47373737.37373738,48080808.08080808,48787878.78787879,49494949.4949495,50202020.202020206,50909090.909090914,51616161.61616162,52323232.32323232,53030303.03030303,53737373.73737374,54444444.44444445,55151515.151515156,55858585.858585864,56565656.56565657,57272727.27272727,57979797.97979798,58686868.68686869,59393939.3939394,60101010.10101011,60808080.808080815,61515151.515151516,62222222.222222224,62929292.92929293,63636363.63636364,64343434.34343435,65050505.05050506,65757575.75757576,66464646.464646466,67171717.17171718,67878787.87878788,68585858.58585858,69292929.29292929,70000000.0]],"UNDERSATURATED_VISCOSITY":[[0.0012204958651610789,0.0012234251580903717,0.0012263544510196648,0.0012292837439489576,0.0012322130368782505,0.0012351423298075435,0.0012380716227368366,0.0012410009156661294,0.001243930208595422,0.001246859501524715,0.0012497887944540084,0.0012527180873833012,0.0012556473803125943,0.001258576673241887,0.0012615059661711797,0.0012644352591004728,0.0012673645520297656,0.0012702938449590587,0.0012732231378883515,0.0012761524308176446,0.0012790817237469374,0.0012820110166762303,0.0012849403096055236,0.0012878696025348164,0.0012907988954641092,0.001293728188393402,0.001296657481322695,0.001299586774251988,0.0013025160671812808,0.0013054453601105739,0.0013083746530398667,0.0013113039459691595,0.0013142332388984526,0.0013171625318277457,0.0013200918247570385,0.0013230211176863313,0.0013259504106156242,0.0013288797035449172,0.0013318089964742103,0.0013347382894035031,0.001337667582332796,0.0013405968752620888,0.0013435261681913817,0.0013464554611206747,0.0013493847540499678,0.0013523140469792606,0.0013552433399085535,0.0013581726328378467,0.0013611019257671396,0.0013640312186964324,0.0013669605116257253,0.001369889804555018,0.0013728190974843112,0.001375748390413604,0.001378677683342897,0.0013816069762721901,0.0013845362692014827,0.0013874655621307758,0.0013903948550600686,0.0013933241479893617,0.0013962534409186547,0.0013991827338479474,0.0014021120267772406,0.0014050413197065333,0.0014079706126358263,0.0014108999055651192,0.0014138291984944122,0.0014167584914237053,0.0014196877843529981,0.0014226170772822912,0.0014255463702115838,0.0014284756631408769,0.0014314049560701695,0.0014343342489994628,0.0014372635419287556,0.0014401928348580484,0.0014431221277873415,0.0014460514207166343,0.0014489807136459272,0.00145191000657522,0.001454839299504513,0.0014577685924338061,0.001460697885363099,0.001463627178292392,0.0014665564712216849,0.001469485764150978,0.0014724150570802706,0.0014753443500095636,0.0014782736429388567,0.0014812029358681495,0.0014841322287974426,0.0014870615217267354,0.0014899908146560285,0.0014929201075853213,0.0014958494005146141,0.0014987786934439072,0.0015017079863732,0.0015046372793024929,0.0015075665722317857,0.0015104958651610788],[0.000975,0.0009779292929292928,0.0009808585858585856,0.0009837878787878787,0.0009867171717171715,0.0009896464646464646,0.0009925757575757574,0.0009955050505050505,0.0009984343434343433,0.0010013636363636362,0.0010042929292929294,0.0010072222222222223,0.0010101515151515151,0.001013080808080808,0.0010160101010101008,0.0010189393939393939,0.0010218686868686867,0.0010247979797979798,0.0010277272727272726,0.0010306565656565657,0.0010335858585858585,0.0010365151515151513,0.0010394444444444444,0.0010423737373737372,0.0010453030303030303,0.0010482323232323231,0.001051161616161616,0.001054090909090909,0.0010570202020202019,0.0010599494949494947,0.0010628787878787878,0.0010658080808080808,0.0010687373737373737,0.0010716666666666665,0.0010745959595959596,0.0010775252525252524,0.0010804545454545455,0.0010833838383838383,0.0010863131313131312,0.0010892424242424242,0.0010921717171717173,0.00109510101010101,0.001098030303030303,0.0011009595959595958,0.0011038888888888888,0.0011068181818181817,0.0011097474747474747,0.0011126767676767676,0.0011156060606060604,0.0011185353535353535,0.0011214646464646463,0.0011243939393939394,0.0011273232323232322,0.001130252525252525,0.001133181818181818,0.0011361111111111112,0.001139040404040404,0.0011419696969696969,0.0011448989898989897,0.0011478282828282828,0.0011507575757575756,0.0011536868686868684,0.0011566161616161615,0.0011595454545454543,0.0011624747474747474,0.0011654040404040404,0.0011683333333333333,0.0011712626262626261,0.001174191919191919,0.001177121212121212,0.0011800505050505049,0.001182979797979798,0.0011859090909090908,0.0011888383838383838,0.0011917676767676767,0.0011946969696969695,0.0011976262626262626,0.0012005555555555554,0.0012034848484848485,0.0012064141414141413,0.0012093434343434344,0.0012122727272727272,0.00121520202020202,0.0012181313131313129,0.001221060606060606,0.0012239898989898988,0.0012269191919191918,0.0012298484848484847,0.0012327777777777777,0.0012357070707070706,0.0012386363636363636,0.0012415656565656565,0.0012444949494949493,0.0012474242424242424,0.0012503535353535352,0.0012532828282828283,0.0012562121212121211,0.001259141414141414,0.001262070707070707,0.0012649999999999998],[0.00091,0.0009129292929292928,0.0009158585858585859,0.0009187878787878787,0.0009217171717171717,0.0009246464646464646,0.0009275757575757575,0.0009305050505050505,0.0009334343434343434,0.0009363636363636362,0.0009392929292929293,0.0009422222222222223,0.0009451515151515151,0.000948080808080808,0.0009510101010101009,0.000953939393939394,0.0009568686868686869,0.0009597979797979798,0.0009627272727272727,0.0009656565656565657,0.0009685858585858585,0.0009715151515151514,0.0009744444444444444,0.0009773737373737375,0.0009803030303030303,0.0009832323232323232,0.0009861616161616162,0.000989090909090909,0.000992020202020202,0.0009949494949494948,0.0009978787878787878,0.0010008080808080809,0.0010037373737373737,0.0010066666666666666,0.0010095959595959596,0.0010125252525252525,0.0010154545454545455,0.0010183838383838384,0.0010213131313131312,0.0010242424242424243,0.001027171717171717,0.00103010101010101,0.001033030303030303,0.0010359595959595958,0.0010388888888888889,0.001041818181818182,0.0010447474747474748,0.0010476767676767676,0.0010506060606060605,0.0010535353535353535,0.0010564646464646464,0.0010593939393939392,0.0010623232323232323,0.001065252525252525,0.001068181818181818,0.0010711111111111112,0.0010740404040404038,0.001076969696969697,0.0010798989898989897,0.0010828282828282828,0.0010857575757575759,0.0010886868686868687,0.0010916161616161615,0.0010945454545454544,0.0010974747474747474,0.0011004040404040403,0.0011033333333333333,0.0011062626262626264,0.001109191919191919,0.001112121212121212,0.001115050505050505,0.001117979797979798,0.0011209090909090908,0.0011238383838383839,0.0011267676767676767,0.0011296969696969696,0.0011326262626262626,0.0011355555555555555,0.0011384848484848485,0.0011414141414141413,0.0011443434343434342,0.0011472727272727272,0.00115020202020202,0.0011531313131313131,0.0011560606060606058,0.0011589898989898988,0.0011619191919191919,0.0011648484848484847,0.0011677777777777778,0.0011707070707070706,0.0011736363636363637,0.0011765656565656565,0.0011794949494949494,0.0011824242424242424,0.001185353535353535,0.0011882828282828283,0.0011912121212121212,0.001194141414141414,0.0011970707070707068,0.0012],[0.00083,0.0008329292929292928,0.0008358585858585858,0.0008387878787878786,0.0008417171717171717,0.0008446464646464646,0.0008475757575757576,0.0008505050505050504,0.0008534343434343434,0.0008563636363636362,0.0008592929292929293,0.0008622222222222221,0.0008651515151515152,0.000868080808080808,0.000871010101010101,0.000873939393939394,0.0008768686868686869,0.0008797979797979798,0.0008827272727272728,0.0008856565656565657,0.0008885858585858586,0.0008915151515151516,0.0008944444444444445,0.0008973737373737375,0.0009003030303030304,0.0009032323232323232,0.0009061616161616161,0.0009090909090909091,0.0009120202020202019,0.000914949494949495,0.0009178787878787878,0.0009208080808080809,0.0009237373737373737,0.0009266666666666666,0.0009295959595959596,0.0009325252525252527,0.0009354545454545454,0.0009383838383838384,0.0009413131313131313,0.0009442424242424243,0.0009471717171717171,0.00095010101010101,0.0009530303030303029,0.0009559595959595958,0.0009588888888888889,0.0009618181818181817,0.0009647474747474747,0.0009676767676767676,0.0009706060606060605,0.0009735353535353534,0.0009764646464646464,0.0009793939393939392,0.0009823232323232323,0.0009852525252525251,0.0009881818181818182,0.000991111111111111,0.0009940404040404039,0.0009969696969696971,0.00099989898989899,0.0010028282828282828,0.0010057575757575759,0.0010086868686868687,0.0010116161616161615,0.0010145454545454546,0.0010174747474747474,0.0010204040404040403,0.0010233333333333333,0.0010262626262626264,0.001029191919191919,0.001032121212121212,0.001035050505050505,0.001037979797979798,0.0010409090909090908,0.0010438383838383839,0.0010467676767676767,0.0010496969696969696,0.0010526262626262626,0.0010555555555555555,0.0010584848484848485,0.0010614141414141414,0.0010643434343434344,0.0010672727272727273,0.00107020202020202,0.0010731313131313132,0.001076060606060606,0.0010789898989898988,0.0010819191919191919,0.0010848484848484847,0.0010877777777777778,0.0010907070707070706,0.0010936363636363637,0.0010965656565656563,0.0010994949494949494,0.0011024242424242424,0.0011053535353535353,0.0011082828282828283,0.001111212121212121,0.001114141414141414,0.0011170707070707068,0.00112],[0.000695,0.0006979292929292929,0.0007008585858585859,0.0007037878787878787,0.0007067171717171716,0.0007096464646464647,0.0007125757575757576,0.0007155050505050505,0.0007184343434343435,0.0007213636363636363,0.0007242929292929294,0.0007272222222222222,0.0007301515151515152,0.0007330808080808081,0.0007360101010101009,0.0007389393939393939,0.0007418686868686868,0.0007447979797979798,0.0007477272727272727,0.0007506565656565657,0.0007535858585858585,0.0007565151515151514,0.0007594444444444445,0.0007623737373737374,0.0007653030303030303,0.0007682323232323233,0.0007711616161616161,0.0007740909090909091,0.0007770202020202019,0.0007799494949494949,0.0007828787878787879,0.0007858080808080809,0.0007887373737373737,0.0007916666666666666,0.0007945959595959596,0.0007975252525252525,0.0008004545454545454,0.0008033838383838384,0.0008063131313131313,0.0008092424242424242,0.0008121717171717172,0.00081510101010101,0.000818030303030303,0.0008209595959595959,0.000823888888888889,0.0008268181818181818,0.0008297474747474747,0.0008326767676767677,0.0008356060606060606,0.0008385353535353535,0.0008414646464646465,0.0008443939393939393,0.0008473232323232324,0.0008502525252525252,0.0008531818181818183,0.0008561111111111111,0.000859040404040404,0.000861969696969697,0.0008648989898989898,0.0008678282828282829,0.0008707575757575757,0.0008736868686868686,0.0008766161616161616,0.0008795454545454545,0.0008824747474747475,0.0008854040404040404,0.0008883333333333333,0.0008912626262626263,0.0008941919191919191,0.0008971212121212122,0.000900050505050505,0.0009029797979797981,0.0009059090909090909,0.0009088383838383838,0.0009117676767676768,0.0009146969696969696,0.0009176262626262626,0.0009205555555555554,0.0009234848484848485,0.0009264141414141414,0.0009293434343434344,0.0009322727272727273,0.0009352020202020202,0.0009381313131313131,0.000941060606060606,0.000943989898989899,0.0009469191919191919,0.0009498484848484848,0.0009527777777777779,0.0009557070707070707,0.0009586363636363637,0.0009615656565656565,0.0009644949494949494,0.0009674242424242424,0.0009703535353535352,0.0009732828282828284,0.0009762121212121212,0.000979141414141414,0.000982070707070707,0.000985],[0.000594,0.0005968556998556998,0.0005997113997113998,0.0006025670995670995,0.0006054227994227995,0.0006082784992784993,0.0006111341991341991,0.000613989898989899,0.0006168455988455988,0.0006197012987012988,0.0006225569985569985,0.0006254126984126983,0.0006282683982683983,0.0006311240981240981,0.0006339797979797979,0.0006368354978354979,0.0006396911976911977,0.0006425468975468975,0.0006454025974025974,0.0006482582972582973,0.0006511139971139971,0.0006539696969696969,0.0006568253968253967,0.0006596810966810967,0.0006625367965367964,0.0006653924963924963,0.0006682481962481963,0.0006711038961038961,0.0006739595959595959,0.0006768152958152958,0.0006796709956709956,0.0006825266955266955,0.0006853823953823952,0.0006882380952380952,0.000691093795093795,0.0006939494949494949,0.0006968051948051948,0.0006996608946608946,0.0007025165945165944,0.0007053722943722943,0.0007082279942279943,0.0007110836940836941,0.0007139393939393939,0.0007167950937950937,0.0007196507936507936,0.0007225064935064934,0.0007253621933621933,0.0007282178932178931,0.0007310735930735929,0.0007339292929292928,0.0007367849927849927,0.0007396406926406926,0.0007424963924963924,0.0007453520923520922,0.0007482077922077921,0.000751063492063492,0.0007539191919191918,0.0007567748917748917,0.0007596305916305914,0.0007624862914862914,0.0007653419913419912,0.0007681976911976911,0.000771053391053391,0.0007739090909090908,0.0007767647907647906,0.0007796204906204906,0.0007824761904761904,0.0007853318903318904,0.0007881875901875902,0.0007910432900432899,0.0007938989898989898,0.0007967546897546897,0.0007996103896103896,0.0008024660894660894,0.0008053217893217893,0.0008081774891774891,0.0008110331890331889,0.0008138888888888888,0.0008167445887445887,0.0008196002886002885,0.0008224559884559884,0.0008253116883116883,0.0008281673881673881,0.0008310230880230879,0.0008338787878787878,0.0008367344877344877,0.0008395901875901875,0.0008424458874458874,0.0008453015873015873,0.0008481572871572871,0.000851012987012987,0.0008538686868686869,0.0008567243867243867,0.0008595800865800865,0.0008624357864357864,0.0008652914862914863,0.0008681471861471861,0.0008710028860028859,0.0008738585858585859,0.0008767142857142857],[0.00051,0.0005127575757575758,0.0005155151515151516,0.0005182727272727272,0.0005210303030303031,0.0005237878787878788,0.0005265454545454546,0.0005293030303030303,0.000532060606060606,0.0005348181818181819,0.0005375757575757575,0.0005403333333333333,0.0005430909090909091,0.0005458484848484849,0.0005486060606060606,0.0005518939393939393,0.000555270202020202,0.0005586464646464646,0.0005620227272727273,0.00056539898989899,0.0005687752525252525,0.0005721515151515151,0.0005755277777777779,0.0005789040404040405,0.000582280303030303,0.0005856565656565656,0.0005890328282828284,0.0005924090909090909,0.0005957853535353535,0.0005991616161616162,0.0006025378787878788,0.0006059141414141414,0.0006092904040404041,0.0006126666666666666,0.0006160429292929293,0.0006194191919191919,0.0006227954545454545,0.0006261717171717172,0.0006295479797979798,0.0006329242424242425,0.0006363005050505051,0.0006396767676767677,0.0006430530303030304,0.0006464292929292929,0.0006498055555555556,0.0006531818181818182,0.0006565580808080809,0.0006599343434343434,0.0006633106060606061,0.0006666868686868686,0.0006700631313131313,0.000673439393939394,0.0006768156565656565,0.0006801919191919192,0.0006835681818181818,0.0006869444444444445,0.0006903207070707071,0.0006936969696969697,0.0006970732323232324,0.0007004494949494949,0.0007038257575757576,0.0007072020202020203,0.0007105782828282828,0.0007139545454545455,0.0007173308080808081,0.0007207070707070707,0.0007240833333333333,0.0007274595959595959,0.0007308358585858585,0.0007342121212121212,0.0007375883838383839,0.0007409646464646465,0.0007443409090909092,0.0007477171717171717,0.0007510934343434344,0.0007544696969696969,0.0007578459595959596,0.0007612222222222222,0.0007645984848484848,0.0007679747474747475,0.0007713510101010101,0.0007747272727272727,0.0007781035353535353,0.000781479797979798,0.0007848560606060605,0.0007882323232323233,0.0007916085858585859,0.0007949848484848485,0.000798361111111111,0.0008017373737373738,0.0008051136363636364,0.000808489898989899,0.0008118661616161616,0.0008152424242424242,0.0008186186868686868,0.0008219949494949496,0.0008253712121212122,0.0008287474747474747,0.0008321237373737374,0.0008355],[0.000449,0.00045175757575757584,0.0004545151515151515,0.0004572727272727272,0.000460030303030303,0.0004627878787878788,0.00046554545454545454,0.0004683030303030303,0.00047106060606060603,0.0004738181818181818,0.0004765757575757576,0.00047933333333333335,0.0004820909090909091,0.0004848484848484848,0.00048760606060606066,0.0004903636363636363,0.0004931212121212121,0.000495878787878788,0.0004986363636363636,0.0005013939393939394,0.0005041515151515152,0.0005069090909090909,0.0005096666666666667,0.0005124242424242424,0.0005151818181818182,0.0005179393939393939,0.0005206969696969696,0.0005234545454545455,0.0005262121212121213,0.000528969696969697,0.0005317272727272727,0.0005344848484848485,0.0005372424242424242,0.00054,0.0005427575757575758,0.0005455151515151516,0.0005482727272727273,0.000551030303030303,0.0005537878787878788,0.0005565454545454545,0.0005593030303030303,0.0005620606060606061,0.0005648181818181817,0.0005675757575757575,0.0005703333333333333,0.0005730909090909091,0.0005758484848484848,0.0005786060606060605,0.0005813636363636363,0.0005841212121212121,0.0005868787878787879,0.0005896363636363637,0.0005923939393939394,0.0005951515151515151,0.000597909090909091,0.0006006666666666666,0.0006034242424242424,0.0006061818181818181,0.000608939393939394,0.0006116969696969695,0.0006144545454545454,0.0006172121212121212,0.000619969696969697,0.0006227272727272727,0.0006254848484848484,0.0006282424242424242,0.0006309999999999999,0.0006337575757575757,0.0006365151515151515,0.0006392727272727273,0.0006420303030303029,0.0006447878787878788,0.0006475454545454545,0.0006503030303030301,0.000653060606060606,0.0006558181818181818,0.0006585757575757576,0.0006613333333333332,0.0006640909090909091,0.0006668484848484848,0.0006696060606060606,0.0006723636363636363,0.0006751212121212121,0.0006778787878787877,0.0006806363636363635,0.0006833939393939393,0.0006861515151515151,0.0006889090909090909,0.0006916666666666666,0.0006944242424242423,0.0006971818181818181,0.0006999393939393938,0.0007026969696969697,0.0007054545454545452,0.0007082121212121211,0.0007109696969696969,0.0007137272727272726,0.0007164848484848483,0.0007192424242424242,0.0007219999999999999]]},"SURFACE_MASS_DENSITY":800.0,"SURFACE_MOLECULAR_WEIGHT":0.114,"SURFACE_MOLE_DENSITY":7017.543859649122}}},"PHASE_MOLE_FRACTION":{"GAS":{"dP":-2.1451413631439145e-10,"dT":0.0,"dz":[-0.4033842935373837,0.6563929130247901,-0.3586056404325153],"value":0.3586056428865975},"LIQUID_WATER_RICH":{"dP":0.0,"dT":0.0,"dz":[-0.6293994491597881,-0.6293995875779607,0.37060041404019134],"value":0.6293995826008856},"OIL":{"dP":2.1451413631439145e-10,"dT":0.0,"dz":[1.0327839676113724,-0.026993304402208075,-0.011994767688876121],"value":0.011994774512516848}},"PHASE_PROPERTIES":{"GAS":{"COMPRESSIBILITY":0.0,"COMPRESSIBILITY_FACTOR":{"dP":0.0,"dT":0.0,"dz":[0.0,0.0,0.0],"value":0.0},"LN_FUGACITY_COEFFICIENTS":{"dP":[1.7924544811248727e-07,2.0029795169830264e-07,0.0],"dT":[0.0,0.0,0.0],"dz":[[0.0,0.0,0.0],[0.0,0.0,0.0],[0.0,0.0,0.0]],"value":[11.167088730307075,15.410694807702667,0.0]},"MASS_DENSITY":{"dP":-3.2437974452972316e-06,"dT":0.0,"dz":[0.0,0.0,0.0],"value":13.476347182229528},"MASS_ENTHALPY":0.0,"MOLECULAR_WEIGHT":{"dP":-2.87857372313737e-11,"dT":0.0,"dz":[0.0,0.0,0.0],"value":0.017386950897250203},"MOLE_COMPOSITION":{"dP":[-2.9373019933700475e-10,2.9373019933700475e-10,0.0],"dT":[0.0,0.0,0.0],"dz":[[0.0,0.0,0.0],[0.0,0.0,0.0],[0.0,0.0,0.0]],"value":[0.0141525601760224,0.9858474398239776,0.0]},"MOLE_DENSITY":{"dP":-0.0001852818298339838,"dT":0.0,"dz":[0.0,0.0,0.0],"value":775.0839846428078},"VISCOSITY":1.3311977863139463e-05},"LIQUID_WATER_RICH":{"COMPRESSIBILITY":0.0,"COMPRESSIBILITY_FACTOR":{"dP":0.0,"dT":0.0,"dz":[0.0,0.0,0.0],"value":0.0},"LN_FUGACITY_COEFFICIENTS":{"dP":[1.7924544811248727e-07,2.0029795169830264e-07,0.0],"dT":[0.0,0.0,0.0],"dz":[[0.0,0.0,0.0],[0.0,0.0,0.0],[0.0,0.0,0.0]],"value":[11.167088730307075,15.410694807702667,0.0]},"MASS_DENSITY":{"dP":4.025665283203113e-07,"dT":0.0,"dz":[0.0,0.0,0.0],"value":981.8729964578481},"MASS_ENTHALPY":0.0,"MOLECULAR_WEIGHT":{"dP":0.0,"dT":0.0,"dz":[0.0,0.0,0.0],"value":0.018},"MOLE_COMPOSITION":{"dP":[0.0,0.0,0.0],"dT":[0.0,0.0,0.0],"dz":[[0.0,0.0,0.0],[0.0,0.0,0.0],[0.0,0.0,0.0]],"value":[0.0,0.0,1.0]},"MOLE_DENSITY":{"dP":2.2364843749999933e-05,"dT":0.0,"dz":[0.0,0.0,0.0],"value":54548.49980321379},"VISCOSITY":0.0003},"OIL":{"COMPRESSIBILITY":0.0,"COMPRESSIBILITY_FACTOR":{"dP":0.0,"dT":0.0,"dz":[0.0,0.0,0.0],"value":0.0},"LN_FUGACITY_COEFFICIENTS":{"dP":[1.792453050613398e-07,2.0029795169830264e-07,0.0],"dT":[0.0,0.0,0.0],"dz":[[0.0,0.0,0.0],[0.0,0.0,0.0],[0.0,0.0,0.0]],"value":[11.16708873030708,15.410694807702667,0.0]},"MASS_DENSITY":{"dP":-5.556488037109359e-07,"dT":0.0,"dz":[0.0,0.0,0.0],"value":781.5082524271844},"MASS_ENTHALPY":0.0,"MOLECULAR_WEIGHT":{"dP":-7.931670174002623e-10,"dT":0.0,"dz":[0.0,0.0,0.0],"value":0.10985920326376224},"MOLE_COMPOSITION":{"dP":[-8.09354186058042e-09,8.09354186058042e-09,0.0],"dT":[0.0,0.0,0.0],"dz":[[0.0,0.0,0.0],[0.0,0.0,0.0],[0.0,0.0,0.0]],"value":[0.9577469720792066,0.04225302792079344,0.0]},"MOLE_DENSITY":{"dP":4.630222167968736e-05,"dT":0.0,"dz":[0.0,0.0,0.0],"value":7113.725834610798},"VISCOSITY":0.00091}},"PHASE_STATE":"OIL_GAS_WATER","PHASE_TYPES":["OIL","GAS","LIQUID_WATER_RICH"],"PRESSURE":5000000.0,"TEMPERATURE":297.15}}
  )"_json;

  json const & refProperties = j1["PROPERTIES"];

  pds::MultiphaseSystemProperties
    refMsp = refProperties.get< pds::MultiphaseSystemProperties >();
  // TODO componentProperties must be serialized aside the MSP

  PVTPackage::MultiphaseSystemProperties msp( convert( refMsp.PhaseTypes ), refMsp.Feed.size() );
  msp.Temperature = refMsp.Temperature;
  msp.Pressure = refMsp.Pressure;
  msp.Feed = refMsp.Feed;
  msp.PhaseModels = convert( refMsp.PhaseModels );
  // the PhaseMoleFraction and PhasesProperties seem to be the results, so no need to copy.

  PVTPackage::BlackOilFlash blackOilFlash;
  blackOilFlash.ComputeEquilibrium( msp );

  compare( msp, refMsp );
}

TEST( PVTPackageRefactor, deadOil )
{
  // This is deadOil
  json j1 = R"(
  {"PROPERTIES":{"FEED":[0.016563146842587414,0.3540372637603059,0.6293995893971067],"PHASE_MODELS":{"GAS":{"TYPE":"PHASE_MODEL_TYPE_DEAD_OIL","VALUE":{"MAX_PRESSURE":53000000.0,"MIN_PRESSURE":101325.0,"PHASE_TYPE":"GAS","PVD_DATA":{"B":[0.04234,0.02046,0.01328,0.00977,0.00773,0.006426,0.005541,0.004919,0.004471,0.004194,0.004031,0.00391,0.003868],"N_POINTS":13,"PRESSURE":[101325.0,3000000.0,6000000.0,9000000.0,12000000.0,15000000.0,18000000.0,21000000.0,24000000.0,27000000.0,29500000.0,31000000.0,33000000.0,53000000.0],"VISCOSITY":[1.344e-05,1.42e-05,1.526e-05,1.66e-05,1.818e-05,1.994e-05,2.181e-05,2.37e-05,2.559e-05,2.714e-05,2.806e-05,2.832e-05,2.935e-05]},"SURFACE_MASS_DENSITY":0.9907,"SURFACE_MOLECULAR_WEIGHT":0.016,"SURFACE_MOLE_DENSITY":61.91875}},"LIQUID_WATER_RICH":{"TYPE":"PHASE_MODEL_TYPE_BLACK_OIL_WATER","VALUE":{"PVTW_DATA":{"BW":1.03,"COMPRESSIBILITY":4.1e-10,"REFERENCE_PRESSURE":30600000.1,"VISCOSITY":0.0003},"SURFACE_MASS_DENSITY":1022.0,"SURFACE_MOLECULAR_WEIGHT":0.018,"SURFACE_MOLE_DENSITY":56777.77777777778}},"OIL":{"TYPE":"PHASE_MODEL_TYPE_DEAD_OIL","VALUE":{"MAX_PRESSURE":50000000.7,"MIN_PRESSURE":101325.0,"PHASE_TYPE":"OIL","PVD_DATA":{"B":[1.02,1.03,1.04,1.05,1.07,1.08,1.09],"N_POINTS":7,"PRESSURE":[101325.0,2000000.0,5000000.0,10000000.0,20000000.0,30000000.0,40000000.0,50000000.7],"VISCOSITY":[0.000975,0.00091,0.00083,0.000695,0.000594,0.00051,0.000449]},"SURFACE_MASS_DENSITY":800.0,"SURFACE_MOLECULAR_WEIGHT":0.114,"SURFACE_MOLE_DENSITY":7017.543859649122}}},"PHASE_MOLE_FRACTION":{"GAS":{"dP":0.0,"dT":0.0,"dz":[-0.35403721971934654,0.6459627269585969,-0.3540372641469532],"value":0.3540372637603059},"LIQUID_WATER_RICH":{"dP":0.0,"dT":0.0,"dz":[-0.629399451742349,-0.6293995995393094,0.3706003982008694],"value":0.6293995893971067},"OIL":{"dP":0.0,"dT":0.0,"dz":[0.9834368542044843,-0.01656314714862043,-0.016563147001290936],"value":0.016563146842587414}},"PHASE_PROPERTIES":{"GAS":{"COMPRESSIBILITY":0.0,"COMPRESSIBILITY_FACTOR":{"dP":0.0,"dT":0.0,"dz":[0.0,0.0,0.0],"value":0.0},"LN_FUGACITY_COEFFICIENTS":{"dP":[0.0,0.0,0.0],"dT":[0.0,0.0,0.0],"dz":[[0.0,0.0,0.0],[0.0,0.0,0.0],[0.0,0.0,0.0]],"value":[0.0,0.0,0.0]},"MASS_DENSITY":{"dP":9.652118110656709e-06,"dT":0.0,"dz":[0.0,0.0,0.0],"value":63.209272649936196},"MASS_ENTHALPY":0.0,"MOLECULAR_WEIGHT":{"dP":0.0,"dT":0.0,"dz":[0.0,0.0,0.0],"value":0.016},"MOLE_COMPOSITION":{"dP":[0.0,0.0,0.0],"dT":[0.0,0.0,0.0],"dz":[[0.0,0.0,0.0],[0.0,0.0,0.0],[0.0,0.0,0.0]],"value":[0.0,1.0,0.0]},"MOLE_DENSITY":{"dP":0.0006032573791503889,"dT":0.0,"dz":[0.0,0.0,0.0],"value":3950.5795406210123},"VISCOSITY":1.4906666666666667e-05},"LIQUID_WATER_RICH":{"COMPRESSIBILITY":0.0,"COMPRESSIBILITY_FACTOR":{"dP":0.0,"dT":0.0,"dz":[0.0,0.0,0.0],"value":0.0},"LN_FUGACITY_COEFFICIENTS":{"dP":[0.0,0.0,0.0],"dT":[0.0,0.0,0.0],"dz":[[0.0,0.0,0.0],[0.0,0.0,0.0],[0.0,0.0,0.0]],"value":[0.0,0.0,0.0]},"MASS_DENSITY":{"dP":4.025665283203113e-07,"dT":0.0,"dz":[0.0,0.0,0.0],"value":981.8729964578481},"MASS_ENTHALPY":0.0,"MOLECULAR_WEIGHT":{"dP":0.0,"dT":0.0,"dz":[0.0,0.0,0.0],"value":0.018},"MOLE_COMPOSITION":{"dP":[0.0,0.0,0.0],"dT":[0.0,0.0,0.0],"dz":[[0.0,0.0,0.0],[0.0,0.0,0.0],[0.0,0.0,0.0]],"value":[0.0,0.0,1.0]},"MOLE_DENSITY":{"dP":2.2364843749999933e-05,"dT":0.0,"dz":[0.0,0.0,0.0],"value":54548.49980321379},"VISCOSITY":0.0003},"OIL":{"COMPRESSIBILITY":0.0,"COMPRESSIBILITY_FACTOR":{"dP":0.0,"dT":0.0,"dz":[0.0,0.0,0.0],"value":0.0},"LN_FUGACITY_COEFFICIENTS":{"dP":[0.0,0.0,0.0],"dT":[0.0,0.0,0.0],"dz":[[0.0,0.0,0.0],[0.0,0.0,0.0],[0.0,0.0,0.0]],"value":[0.0,0.0,0.0]},"MASS_DENSITY":{"dP":-1.4792877197265582e-06,"dT":0.0,"dz":[0.0,0.0,0.0],"value":769.2307692307692},"MASS_ENTHALPY":0.0,"MOLECULAR_WEIGHT":{"dP":3.725290298461903e-16,"dT":0.0,"dz":[0.0,0.0,0.0],"value":0.114},"MOLE_COMPOSITION":{"dP":[0.0,0.0,0.0],"dT":[0.0,0.0,0.0],"dz":[[0.0,0.0,0.0],[0.0,0.0,0.0],[0.0,0.0,0.0]],"value":[1.0,0.0,0.0]},"MOLE_DENSITY":{"dP":-1.2976220703124961e-05,"dT":0.0,"dz":[0.0,0.0,0.0],"value":6747.638326585694},"VISCOSITY":0.00083}},"PHASE_STATE":"OIL_GAS_WATER","PHASE_TYPES":["OIL","GAS","LIQUID_WATER_RICH"],"PRESSURE":5000000.0,"TEMPERATURE":297.15}}
  )"_json;

  json const & refProperties = j1["PROPERTIES"];

  pds::MultiphaseSystemProperties
    refMsp = refProperties.get< pds::MultiphaseSystemProperties >();


  PVTPackage::MultiphaseSystemProperties msp( convert( refMsp.PhaseTypes ), refMsp.Feed.size() );
  msp.Temperature = refMsp.Temperature;
  msp.Pressure = refMsp.Pressure;
  msp.Feed = refMsp.Feed;
  msp.PhaseModels = convert( refMsp.PhaseModels );

  PVTPackage::DeadOilFlash deadOilFlash;
  deadOilFlash.ComputeEquilibrium( msp );

  compare( msp, refMsp );

}

} // end of namespace refactor
} // end of namespace PVTPackage
